<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.connect.data.dao.IFollowDao">
    <resultMap id="followResultMap" type="com.connect.data.entity.Follow">
        <id property="id" column="id"/>
        <result property="followerId" column="followerId"/>
        <result property="followingId" column="followingId"/>
        <result property="isActive" column="isActive"/>
        <result property="dbCreateTime" column="db_create_time"/>
        <result property="dbModifyTime" column="db_modify_time"/>
    </resultMap>

    <insert id="createFollow" parameterType="com.connect.data.entity.Follow" useGeneratedKeys="true"
            keyProperty="id" keyColumn="id">
        INSERT INTO follow(followerId, followingId, isActive)
        VALUES (
        #{followerId, jdbcType=VARCHAR},
        #{followingId, jdbcType=VARCHAR},
        #{isActive,jdbcType=BOOLEAN}
        )
    </insert>

    <update id="updateFollow" parameterType="com.connect.data.entity.Follow">
        UPDATE follow
        <trim prefix="set" suffixOverrides=",">
            <if test="isActive != null">
                isActive = #{isActive, jdbcType=BOOLEAN}
            </if>
        </trim>
        WHERE followerId = #{followerId, jdbcType=VARCHAR}
        AND followingId = #{followingId, jdbcType=VARCHAR}
    </update>

    <select id="followExisting" resultType="java.lang.Boolean">
        SELECT EXISTS(
        SELECT id
        FROM follow
        WHERE followerId = #{followerId, jdbcType=VARCHAR}
        AND followingId = #{followingId, jdbcType=VARCHAR}
        )
    </select>

    <select id="followExistingWithTargetStatus" resultType="java.lang.Boolean">
        SELECT EXISTS(
        SELECT id
        FROM follow
        WHERE followerId = #{followerId, jdbcType=VARCHAR}
        AND followingId = #{followingId, jdbcType=VARCHAR}
        AND isActive = #{isActive, jdbcType=BOOLEAN}
        )
    </select>

    <select id="countFollower" resultType="java.lang.Integer">
        SELECT COUNT(followerId)
        FROM follow
        WHERE followingId = #{followingId, jdbcType=VARCHAR}
        AND isActive = TRUE
    </select>

    <select id="countFollowing" resultType="java.lang.Integer">
        SELECT COUNT(followingId)
        FROM follow
        WHERE followerId = #{followerId, jdbcType=VARCHAR}
        AND isActive = TRUE
    </select>

    <select id="queryFollowerIdList" resultType="java.lang.Integer">
        SELECT followerId

        FROM follow
        WHERE followingId = #{followingId, jdbcType=VARCHAR}
        AND isActive = TRUE
    </select>

    <select id="queryFollowingIdList" resultType="java.lang.Integer">
        SELECT followingId

        FROM follow
        WHERE followerId = #{followerId, jdbcType=VARCHAR}
        AND isActive = TRUE
    </select>
</mapper>